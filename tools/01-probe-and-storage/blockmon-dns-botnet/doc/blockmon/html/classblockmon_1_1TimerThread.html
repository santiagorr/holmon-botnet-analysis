<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>blockmon: blockmon::TimerThread Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">blockmon
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceblockmon.html">blockmon</a></li><li class="navelem"><a class="el" href="classblockmon_1_1TimerThread.html">TimerThread</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="classblockmon_1_1TimerThread-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">blockmon::TimerThread Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="TimerThread_8hpp_source.html">TimerThread.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><b>hsorter</b></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><b>remover</b></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:af91f3f244e53a23fcbb2627faceea544"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classblockmon_1_1TimerThread.html#af91f3f244e53a23fcbb2627faceea544">schedule_timer</a> (std::shared_ptr&lt; <a class="el" href="classblockmon_1_1Timer.html">Timer</a> &gt; &amp;&amp;in)</td></tr>
<tr class="memitem:a19eba82947652cd8928f10a33ca9999f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classblockmon_1_1TimerThread.html#a19eba82947652cd8928f10a33ca9999f">stop</a> ()</td></tr>
<tr class="memitem:a1f11ff120e10b1a358f9d1a704a6d9a6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classblockmon_1_1TimerThread.html#a1f11ff120e10b1a358f9d1a704a6d9a6">operator()</a> ()</td></tr>
<tr class="memitem:a7087f1f2f82839c0d6afde05881f98f7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classblockmon_1_1TimerThread.html#a7087f1f2f82839c0d6afde05881f98f7">process_timer_events</a> ()</td></tr>
<tr class="memitem:ac63b483d4ecffcf944bc3d390f52b459"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classblockmon_1_1TimerThread.html#ac63b483d4ecffcf944bc3d390f52b459">remove_references</a> (const <a class="el" href="classblockmon_1_1Block.html">Block</a> &amp;b)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ac87b357ad13a7bcf0e376405ec2d9619"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classblockmon_1_1TimerThread.html">TimerThread</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classblockmon_1_1TimerThread.html#ac87b357ad13a7bcf0e376405ec2d9619">instance</a> ()</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:acd40fc8cb8ba63f4758edb20369058ad"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acd40fc8cb8ba63f4758edb20369058ad"></a>
static std::atomic&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>m_instance</b></td></tr>
<tr class="memitem:ade1ccbb89d657059d5f6b4aa9e6da4d2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ade1ccbb89d657059d5f6b4aa9e6da4d2"></a>
static <a class="el" href="classblockmon_1_1TimerThread.html">TimerThread</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>inst</b> = NULL</td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Represent the callable object which is executed by the timer thread and that handles timers for the whole Blockmon instance.</p>
<p>It keeps an ordered timer heap, waits until the next timer is to be executed, and calls the associated <a class="el" href="classblockmon_1_1Block.html#a40d7b972d2b7cfe2244b5bc14b26f11f">Block::handle_timer()</a> function. In order not to waste too much CPU on busy waiting, the threads checks the timer heap every millisecond and handles all of the expired timers. This is an obvious trade-off between precision and resource consumption that can be tuned by changing the sampling interval.</p>
<p>When a block sets up a new timer, this is inserted into a thread-safe timer queue. When the threads wakes up, all of the timers in the queue are pushed into the timer heap. Notice that, if the block is passive, the block's timer handling function is executed in the context of this thread. Notice also that this is a singleton class (there can be only one instance): therefore only one timer thread is allowed, thus guaranteeing that the timers are strictly ordered. For these reasons, timer handling functions that involve a lot of processing should be avoided (unless the block is always meant to be active). </p>

<p>Definition at line <a class="el" href="TimerThread_8hpp_source.html#l00074">74</a> of file <a class="el" href="TimerThread_8hpp_source.html">TimerThread.hpp</a>.</p>
</div><h2>Member Function Documentation</h2>
<a class="anchor" id="ac87b357ad13a7bcf0e376405ec2d9619"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classblockmon_1_1TimerThread.html">TimerThread</a>&amp; blockmon::TimerThread::instance </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>unique instance accessor as in Meyer's singleton </p>
<dl class="section return"><dt>Returns</dt><dd>a reference to the only instance of this class </dd></dl>

<p>Definition at line <a class="el" href="TimerThread_8hpp_source.html#l00153">153</a> of file <a class="el" href="TimerThread_8hpp_source.html">TimerThread.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a1f11ff120e10b1a358f9d1a704a6d9a6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void blockmon::TimerThread::operator() </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is the actual function which is executed by the timer thread It checks the timer queue every millisecond and handles all of the expired timers. After handling one timer (i.e. calling the handle_timer method of the associated block) it checks whether it needs to be rescheduled by calling its next_time virtual function. It runs until it is signalled to stop through the <a class="el" href="classblockmon_1_1TimerThread.html#a19eba82947652cd8928f10a33ca9999f">stop()</a> method </p>
<p>this time interval can be changed in order to tune the precision/performance trade off</p>

<p>Definition at line <a class="el" href="TimerThread_8cpp_source.html#l00059">59</a> of file <a class="el" href="TimerThread_8cpp_source.html">TimerThread.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a7087f1f2f82839c0d6afde05881f98f7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void blockmon::TimerThread::process_timer_events </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>checks if there are any timer events which should be processed and calls the handle_timer methods on the corresponding blocks. This can be called from outside in case you want to make sure that all timer events have been processed at a certain time. </p>

<p>Definition at line <a class="el" href="TimerThread_8cpp_source.html#l00094">94</a> of file <a class="el" href="TimerThread_8cpp_source.html">TimerThread.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ac63b483d4ecffcf944bc3d390f52b459"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void blockmon::TimerThread::remove_references </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classblockmon_1_1Block.html">Block</a> &amp;&#160;</td>
          <td class="paramname"><em>b</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Removes both from the timer heap and the timer queue all of the timers associated to a given block. This is needed when a block is removed, otherwise invalid references to is would be left. This function is called by the destructor of the block superclass and can only be executed when the timer thread is stopped </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>const reference to the <a class="el" href="classblockmon_1_1Block.html">Block</a> whose timers are to be removed (it is only used to derive the block address) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="TimerThread_8cpp_source.html#l00122">122</a> of file <a class="el" href="TimerThread_8cpp_source.html">TimerThread.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="af91f3f244e53a23fcbb2627faceea544"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void blockmon::TimerThread::schedule_timer </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="classblockmon_1_1Timer.html">Timer</a> &gt; &amp;&amp;&#160;</td>
          <td class="paramname"><em>in</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is called by the block (through its base class functions) in order to schedule a timer </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">in</td><td>a shared pointer to the timer to be scheduled (as r-value reference). The timer is provisionally stored into a timer queue and will be pushed into the heap the next time this thread wakes up. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="TimerThread_8cpp_source.html#l00049">49</a> of file <a class="el" href="TimerThread_8cpp_source.html">TimerThread.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a19eba82947652cd8928f10a33ca9999f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void blockmon::TimerThread::stop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Notifies the timer thread functor that is should stop by setting a boolean flag </p>

<p>Definition at line <a class="el" href="TimerThread_8cpp_source.html#l00055">55</a> of file <a class="el" href="TimerThread_8cpp_source.html">TimerThread.cpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/santiago/src/blockmon-compile-a-la-upstream/blockmon-0.827872f/core/time/<a class="el" href="TimerThread_8hpp_source.html">TimerThread.hpp</a></li>
<li>/home/santiago/src/blockmon-compile-a-la-upstream/blockmon-0.827872f/core/time/<a class="el" href="TimerThread_8cpp_source.html">TimerThread.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Dec 2 2013 17:48:35 for blockmon by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
