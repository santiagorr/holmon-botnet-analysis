<composition id="DNSBotAnalysis" app_id="BA">
  <general>
    <clock type="wall" />
  </general>

  <install>
    <threadpool id="src_thread" num_threads="1" >
      <core number="0"/>
	</threadpool>
    
    <block id="src" type="PcapSource" invocation="async" threadpool="src_thread">	  
      <params>
        <source type='live' name='eth0'/> 
      </params>
    </block>

      <block id="filter" type="PacketFilter" invocation="direct"> 
        <params>
          <l3_protocol number="2048">
            <filter_mode behavior="accept"/>
          </l3_protocol>
          <!-- UDP -->
          <l4_protocol number="17">
            <filter_mode behavior="accept"/>
          </l4_protocol>
          <src_port number='53'>
            <filter_mode behavior='accept'/>
          </src_port>
        </params>
      </block>

      <block id="filterDst" type="PacketFilter" invocation="direct"> 
        <params>
          <l3_protocol number="2048">
            <filter_mode behavior="accept"/>
          </l3_protocol>
          <l4_protocol number="17">
            <filter_mode behavior="accept"/>
          </l4_protocol>
          <dst_port number='53'>
            <filter_mode behavior='accept'/>
          </dst_port>
        </params>
      </block>

      <block id="botmapper" type="DNSBotMapper" invocation="direct"> 
        <params>
            <db_name val = "holmondns" />
            <db_ip val = "localhost"/>
            <db_user val = "holmon"/>
            <db_passwd val = "holmon"/>
        </params>
      </block>

      <connection src_block="src" src_gate="source_out" dst_block="filter" dst_gate="in_pkt"/>
      <connection src_block="src" src_gate="source_out" dst_block="filterDst" dst_gate="in_pkt"/>
      <connection src_block="filter" src_gate="out_pkt" dst_block="botmapper" dst_gate="in_msg"/>
      <connection src_block="filterDst" src_gate="out_pkt" dst_block="botmapper" dst_gate="in_msg"/>

  </install>
</composition>
